# Workflow: Update GraphQL model

Step-by-step workflow for changing the GraphQL schema and frontend usage. Use when adding or changing types, fields, or resolvers in the CRN API.

**Important:** Complete the schema change and Amplify codegen steps below, and **verify** that generated types and the build succeed, **before** writing or changing any UX code (new components, routes, i18n, or edits to existing UI that depend on the new model). UX code must run against the already-generated `src/API.ts` and `src/graphql/*` output.

## Prerequisites

- AWS Amplify CLI installed and configured
- AWS credentials for the project
- Local clone up to date

## Steps

1. **Pull latest backend state**
   ```bash
   amplify pull
   ```
   Use the same environment (e.g. dev/production) as your team.

2. **Edit the schema**
   - Open `amplify/backend/api/crn/schema.graphql`
   - Add or modify types, fields, and (if needed) resolver references
   - Do not edit `src/API.ts` or `src/graphql/*.ts` â€” they are generated by Amplify codegen

3. **Push and run Amplify codegen**
   ```bash
   amplify push
   ```
   When prompted to update code and GraphQL queries, select **yes**. Amplify will:
   - Update the backend (AppSync, DynamoDB, etc.)
   - Regenerate `src/API.ts` (TypeScript types from the schema)
   - Regenerate `src/graphql/{queries,mutations,subscriptions}.ts` (operations)
   Codegen is driven by `.graphqlconfig.yml` (generatedFileName: `src/API.ts`, docsFilePath: `src/graphql`).

4. **Verify codegen before any UX work**
   - Confirm `src/API.ts` and `src/graphql/*.ts` contain the new types and operations.
   - Run `npm run build` and ensure it succeeds. TypeScript must compile against the new generated types.
   - **Do not implement or change UX** (new routes, components, i18n, or UI that uses the new model) until this verification passes. All UX code must be written against the verified generated output.

5. **Update frontend code** (only after step 4)
   - Update or add components and hooks that use the changed model.
   - Use the new types from `src/API.ts` and operations from `src/graphql/`.
   - Run `npm run build` again to ensure TypeScript still compiles.

6. **Test**
   - Run `npm test`
   - Manually test all components that interact with the changed model (forms, tables, dialogs)

7. **Commit and deploy**
   - Commit the schema change and all frontend changes
   - Push to GitHub to trigger the Amplify frontend build

## Caveats

- **Avoid test data the frontend does not support yet.** If you add new fields or types, do not create production or long-lived test data that the published frontend cannot display or edit until the new frontend is deployed.
- GraphQL schema changes affect the entire app and all generated types; run the full test suite and a quick smoke test of main routes after `amplify push`.

## Reference

- Canonical context: [docs/ARCHITECTURE.md](../ARCHITECTURE.md) (GraphQL API, do-not-edit list, key files)
- Entrypoint for agents: [AGENTS.md](../../AGENTS.md)

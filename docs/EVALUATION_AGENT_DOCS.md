# Evaluation: Agent markdown and repo consistency

Evaluation of all agent-related markdown against the repository contents and Amplify knowledge. Includes inconsistencies found and suggestions for a successful "new UX + GraphQL model change" agent experience.

---

## 1. Inconsistencies found

### 1.1 GraphQL model names (docs/ARCHITECTURE.md)

**Issue:** ARCHITECTURE lists "Team, TeamPeople" but the schema defines **Team**, **TeamMember**, and **TeamRequest** (no type named TeamPeople). It also omits **SelfOrOtherInfo**, which is a top-level model in the schema.

**Location:** docs/ARCHITECTURE.md, "GraphQL API" → "Models" bullet.

**Fix:** Update to: Request, NoteType, SelfOrOtherInfo, FoodInfo, MovingInfo, HomeRepairType, HouseholdItems, Team, TeamMember, TeamRequest (and enums like LeadSource, NeedReason, NeedType, RequestStatus as needed).

---

### 1.2 CI/CD and GitHub Actions (docs/ARCHITECTURE.md)

**Issue:** ARCHITECTURE says "No GitHub Actions detected" and "The repository doesn't currently have CI/CD workflows defined." The repo has `.github/workflows/test.yml` (runs unit tests on PRs to main/production, creates mock aws-exports, uses Node 22).

**Fix:** Replace that with a short "CI/CD" section: e.g. GitHub Actions run unit tests on pull requests to main/production (see .github/workflows/test.yml); Amplify Console builds the frontend on push.

---

### 1.3 README build output folder

**Issue:** README says "Builds the app for production to the **build** folder." The app uses Vite, which outputs to **dist/** (and ARCHITECTURE correctly says "Output: dist/").

**Fix:** In README, change "build folder" to "dist/ folder" (or "dist/ directory") where the build output is described.

---

### 1.4 Test files and count

**Issue:** Docs say "4 tests pass" and "App.test.tsx, TeamList.test.tsx" but the repo has three test files: App.test.tsx, TeamList.test.tsx, TeamPicker.test.tsx. "4 tests" may mean four `it()` blocks; the list of files is incomplete.

**Fix:** In ARCHITECTURE (and copilot-instructions if it lists files), mention all three: App.test.tsx, TeamList.test.tsx, TeamPicker.test.tsx. Optionally clarify "4 tests" as "4 test cases" or update after counting actual `it()` blocks.

---

### 1.5 RequestAPI.ts vs generated files

**Issue:** ARCHITECTURE says "API.ts (generated), RequestAPI.ts" and do-not-edit lists only `src/API.ts` and `src/graphql/*.ts`. RequestAPI.ts has an "automatically generated and should not be edited" header, but `.graphqlconfig.yml` only generates `src/API.ts` and `src/graphql/`. So RequestAPI.ts is either (a) generated by another process, or (b) a hand-maintained file with a copied header.

**Fix:** Clarify in ARCHITECTURE: if RequestAPI.ts is codegen output (e.g. from a different Amplify/codegen step), add it to the do-not-edit list; if it is hand-maintained and re-exports/wraps API.ts, say it is editable and used as the main import for types/operations in app code. Then agents know whether to edit it when adding new model usage.

---

### 1.6 Workflow link from docs/workflows (CHANGE_LAMBDA, UPDATE_GRAPHQL)

**Issue:** In docs/workflows/UPDATE_GRAPHQL_MODEL.md and CHANGE_LAMBDA.md, the "Entrypoint for agents" link is `[AGENTS.md](../../AGENTS.md)`. From `docs/workflows/`, one level up is `docs/`, two levels up is repo root, so `../../AGENTS.md` is correct. No change needed; just verified.

---

### 1.7 .github/workflows/test.yml comment

**Issue:** The workflow comment says "Use Node.js version matching repository requirements (v20)" but the job uses `node-version: '22'`. Minor doc/comment drift.

**Fix:** In .github/workflows/test.yml, change the comment to "v22" (or "Node 22") to match the actual version.

---

## 2. Amplify-specific checks

- **Schema path:** Docs say `amplify/backend/api/crn/schema.graphql`. Correct; .graphqlconfig uses `amplify/backend/api/crn/build/schema.graphql` for codegen (build output), but editing is done on the source schema in `amplify/backend/api/crn/schema.graphql`. No doc change needed; workflow correctly says to edit the source schema; Amplify builds it.
- **Codegen:** "amplify push" with "yes" to update code runs codegen and updates API.ts and graphql/*. Docs are aligned.
- **Lambda structure:** Each function under `amplify/backend/function/<name>/src/` with its own package.json matches the repo. NotifyTeamOnRequest has no custom-policies.json; others do. Docs don't need to list that; CHANGE_LAMBDA already says "custom-policies.json (if present)."
- **Auth:** Schema uses @auth with public (create, read) and private. Docs mention API_KEY and AMAZON_COGNITO_USER_POOLS; appropriate for high-level context.

---

## 3. Suggestions: successful "new UX + GraphQL model change" agent experience

To make it reliable for agents to **implement a new UX backed by a GraphQL model change**, add the following.

### 3.1 Single end-to-end workflow

Add **docs/workflows/NEW_UX_WITH_GRAPHQL_MODEL.md** (or equivalent) that ties together in one place:

1. **Schema change** — Same as UPDATE_GRAPHQL_MODEL: pull, edit `amplify/backend/api/crn/schema.graphql`, push, accept codegen.
2. **Where to add UX:**
   - **Routes:** Add a new `<Route path="..." element={...} />` in `src/App.tsx` (same pattern as `/request-need`, `/requests`, etc.).
   - **Components:** Add new components under `src/` (e.g. `NewFeatureForm.tsx`). Use existing patterns: functional components, hooks, MUI from `@mui/material`, theme from `src/theme`.
   - **Types:** Use generated types from `src/API.ts` (or the project’s chosen layer, e.g. RequestAPI.ts if that’s the canonical re-export). For form/display types, align with `needRequestTypes.ts` patterns if applicable.
   - **Data:** Use GraphQL operations from `src/graphql/` (queries/mutations/subscriptions); use Amplify API (e.g. generated client) as in existing components (NeedRequestTable, ReportForm, TeamPicker).
3. **i18n:** Add keys to `src/en.json` and `src/es.json`; use `useTranslation()` and `t('key')` as in needRequestForm and App.
4. **Auth:** If the new UX is coordinator-only, protect the route (e.g. same pattern as `/requests` or `/reports`); if public, follow `/request-need` pattern.
5. **Testing:** Add a test file (e.g. `NewFeature.test.tsx`) following `App.test.tsx` / `TeamList.test.tsx` / `TeamPicker.test.tsx`; mock Amplify/GraphQL as in existing tests. Run `npm test` and `npm run build`.
6. **Caveats:** Same as UPDATE_GRAPHQL_MODEL (avoid test data the current frontend doesn’t support; run full test suite and smoke test).

This gives agents one place to look for "new screen + new model" instead of inferring from UPDATE_GRAPHQL_MODEL plus codebase exploration.

### 3.2 Point agents at the workflow

- In **AGENTS.md**, add a bullet under docs/workflows: "New UX backed by GraphQL model: see docs/workflows/NEW_UX_WITH_GRAPHQL_MODEL.md (or the chosen filename)."
- In **docs/ARCHITECTURE.md**, under "Validation and workflows", add a link to this new workflow.
- Optionally add a **Cursor skill** (e.g. `new-ux-graphql`) that says: "Follow docs/workflows/NEW_UX_WITH_GRAPHQL_MODEL.md; use ARCHITECTURE.md for routes, components, i18n, and testing patterns."

### 3.3 Clarify RequestAPI.ts vs API.ts

In ARCHITECTURE, under "Key source files" or "Do-not-edit list", add one line:

- "RequestAPI.ts: [Generated by codegen / Hand-maintained re-export of API.ts]. [Do not edit / Editable for app-specific helpers.]"

Then agents know whether new types/operations should be imported from API.ts only or also from RequestAPI.ts after regeneration.

### 3.4 Optional: example "slice" description

In ARCHITECTURE or in the new workflow, add a short "Example slice" subsection: "To add a new coordinator-facing screen that lists and edits X: (1) Add type X in schema; (2) amplify push; (3) Add route in App.tsx; (4) Add XList.tsx (and XForm.tsx if needed) using RequestAPI/graphql; (5) Add en.json/es.json keys; (6) Add XList.test.tsx." This reduces ambiguity for agents.

---

## 4. Summary of recommended edits

| Item | Action |
|------|--------|
| docs/ARCHITECTURE.md | Fix GraphQL model list (TeamMember, TeamRequest, SelfOrOtherInfo); add CI/CD section; list all three test files; clarify RequestAPI.ts generated vs editable. |
| README.md | Change "build folder" to "dist/ folder" for build output. |
| .github/workflows/test.yml | Fix comment "v20" → "v22". |
| docs/workflows/NEW_UX_WITH_GRAPHQL_MODEL.md | Add (new file) end-to-end workflow for new UX + schema change, routes, components, i18n, tests. |
| AGENTS.md | Add link to NEW_UX_WITH_GRAPHQL_MODEL (or chosen name) under workflows. |
| docs/ARCHITECTURE.md | Link new workflow under "Validation and workflows". |
| .cursor/skills/ | Optionally add new-ux-graphql skill pointing at the new workflow. |

This evaluation is intended to be the single reference for fixing inconsistencies and for extending docs so that "implement new UX backed by a GraphQL model change" is a clear, step-by-step experience for agents.

---

## 5. Applied fixes (after evaluation)

The following were applied in the repo:

- **docs/ARCHITECTURE.md:** GraphQL model list updated (TeamMember, TeamRequest, SelfOrOtherInfo); CI/CD section added; test files list updated (App, TeamList, TeamPicker); RequestAPI.ts clarification added; link to NEW_UX_WITH_GRAPHQL_MODEL.md under Validation and workflows.
- **README.md:** "build folder" changed to "dist/ folder" for build output.
- **.github/workflows/test.yml:** Comment "v20" changed to "v22".
- **docs/workflows/NEW_UX_WITH_GRAPHQL_MODEL.md:** New file added (end-to-end workflow for new UX + schema change, routes, components, i18n, tests).
- **AGENTS.md:** Workflows bullet updated to mention "new UX with GraphQL model."
- **.github/copilot-instructions.md:** Workflows list updated to include NEW_UX_WITH_GRAPHQL_MODEL.md.
- **.cursor/skills/new-ux-graphql/SKILL.md:** New skill added that points at docs/workflows/NEW_UX_WITH_GRAPHQL_MODEL.md.

**Later update (branch docs-graphql-codegen-before-ux):** The new-ux-graphql skill was removed. Emphasis is on completing the GraphQL model change and Amplify codegen (and verifying build) **before** any UX code. UPDATE_GRAPHQL_MODEL.md was strengthened with explicit codegen steps and a "verify before any UX work" gate; NEW_UX_WITH_GRAPHQL_MODEL.md was reframed as "implementing UX only after the model change is complete and verified."
